{% extends 'layout.html' %}

{% block nav %}
    {% include 'students/nav.html' %}
{% endblock %}

{% block content %}

<div id="alertPlaceholder"></div>

<h1>Tutti i corsi</h1>

{% for category, sublist in courses %}
    <div class="accordion" id="accordionCourses">

        <div class="accordion-item mb-3">
            <h2 class="accordion-header" id="heading{{category.id_category}}">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{category.id_category}}" aria-expanded="false" aria-controls="collapse{{category.id_category}}">
                <strong>{{category.c_name}}</strong>
              </button>
            </h2>
            <div id="collapse{{category.id_category}}" class="accordion-collapse collapse" aria-labelledby="heading{{category.id_category}}" data-bs-parent="#accordionExample">
              <div class="accordion-body">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th scope="col">Titolo</th>
                            <th scope="col">Descrizione</th>
                            <th scope="col">Creatore</th>
                            <th scope="col">Data Creazione</th>
                            <th scope="col">Numero iscrizioni massime</th>
                            <th scope="col">Disponibilit√†</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for course in sublist %}    
                        <tr>
                            <th scope="row">{{course.Course.c_name}}</th>
                            <td>{{course.Course.description}}</td>
                            <td>{{course.User.first_name}} {{course.User.last_name}}</td>
                            <td>{{course.Course.creation_date}}</td>
                            <td>{{course.Course.max_partecipants}}</td>
                            <td>
                                <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#modal{{course.Course.id_course}}">
                                    Dettagli
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            </div>
        </div>
        <!-- MODALS -->
        {% for course in sublist %}
        <div class="modal fade" id="modal{{course.Course.id_course}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">{{course.Course.c_name}}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  {{course.Course.id_course}}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" onclick="subscribe('{{course.Course.id_course}}')">Iscriviti</button></td>
                </div>
              </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% endfor %}
<script>
    const alertPlaceholder = document.getElementById('alertPlaceholder')

    function subscribe(id){
        $.ajax({
            type: "POST",
            url: "/student/subscription/"+id,
        }).done(function(response) {
            console.log(response)
            const wrapper = document.createElement('div')
            wrapper.innerHTML = [
                `<div class="alert alert-${response.type} alert-dismissible" role="alert">`,
                `   <div>${response.mess}</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
            ].join('')
            
            alertPlaceholder.append(wrapper)
        });
    }        
</script>


{% endblock content %}
